import{ad as Ve,E as Ye,J as c,a2 as Ie,bq as Qe,br as $e,a4 as Je,g as ie,bs as we,r as et,l as tt,u as Ce,bo as it,bt as nt,bu as st,T as rt,aQ as ce,f as ot,N as I,bv as lt,bg as Xe,bw as be,a1 as D,aH as De,h as at,bx as ht,n as ee,s as te,p as Oe,e as Pe,d as ue,by as ct,z as Ze,bz as ut,bp as dt,S as gt,j as ft,bA as _t,B as Tt,bB as mt,H as P,C as xt,aM as pt,y as Se,w as Fe,bC as Le,A as ze,F as Et,D as Rt,ag as yt,G as wt,k as Ct}from"./Layer-CXuXWfn4.js";class Me extends Ve{constructor(e,t,i){super(),i=i||{},this.tileCoord=e,this.state=t,this.interimTile=null,this.key="",this.transition_=i.transition===void 0?250:i.transition,this.transitionStarts_={},this.interpolate=!!i.interpolate}changed(){this.dispatchEvent(Ye.CHANGE)}release(){this.state===c.ERROR&&this.setState(c.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){let e=this.interimTile;if(!e)return this;do{if(e.getState()==c.LOADED)return this.transition_=0,e;e=e.interimTile}while(e);return this}refreshInterimChain(){let e=this.interimTile;if(!e)return;let t=this;do{if(e.getState()==c.LOADED){e.interimTile=null;break}e.getState()==c.LOADING?t=e:e.getState()==c.IDLE?t.interimTile=e.interimTile:t=e,e=t.interimTile}while(e)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(e){if(this.state!==c.ERROR&&this.state>e)throw new Error("Tile load sequence violation");this.state=e,this.changed()}load(){Ie()}getAlpha(e,t){if(!this.transition_)return 1;let i=this.transitionStarts_[e];if(!i)i=t,this.transitionStarts_[e]=i;else if(i===-1)return 1;const n=t-i+1e3/60;return n>=this.transition_?1:Qe(n/this.transition_)}inTransition(e){return this.transition_?this.transitionStarts_[e]!==-1:!1}endTransition(e){this.transition_&&(this.transitionStarts_[e]=-1)}}class St extends Me{constructor(e,t,i,n,s,r){super(e,t,r),this.crossOrigin_=n,this.src_=i,this.key=i,this.image_=new Image,n!==null&&(this.image_.crossOrigin=n),this.unlisten_=null,this.tileLoadFunction_=s}getImage(){return this.image_}setImage(e){this.image_=e,this.state=c.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=c.ERROR,this.unlistenImage_(),this.image_=Ft(),this.changed()}handleImageLoad_(){const e=this.image_;e.naturalWidth&&e.naturalHeight?this.state=c.LOADED:this.state=c.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==c.ERROR&&(this.state=c.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==c.IDLE&&(this.state=c.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=$e(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function Ft(){const o=Je(1,1);return o.fillStyle="rgba(0,0,0,0)",o.fillRect(0,0,1,1),o.canvas}class ve extends Me{constructor(e,t,i,n,s,r,l,h,a,u,d,m){super(s,c.IDLE,m),this.renderEdges_=d!==void 0?d:!1,this.pixelRatio_=l,this.gutter_=h,this.canvas_=null,this.sourceTileGrid_=t,this.targetTileGrid_=n,this.wrappedTileCoord_=r||s,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const _=n.getTileCoordExtent(this.wrappedTileCoord_),g=this.targetTileGrid_.getExtent();let f=this.sourceTileGrid_.getExtent();const C=g?ie(_,g):_;if(we(C)===0){this.state=c.EMPTY;return}const E=e.getExtent();E&&(f?f=ie(f,E):f=E);const R=n.getResolution(this.wrappedTileCoord_[0]),y=st(e,i,C,R);if(!isFinite(y)||y<=0){this.state=c.EMPTY;return}const x=u!==void 0?u:ot;if(this.triangulation_=new rt(e,i,C,f,y*x,R),this.triangulation_.getTriangles().length===0){this.state=c.EMPTY;return}this.sourceZ_=t.getZForResolution(y);let p=this.triangulation_.calculateSourceExtent();if(f&&(e.canWrapX()?(p[1]=ce(p[1],f[1],f[3]),p[3]=ce(p[3],f[1],f[3])):p=ie(p,f)),!we(p))this.state=c.EMPTY;else{const w=t.getTileRangeForExtentAndZ(p,this.sourceZ_);for(let Z=w.minX;Z<=w.maxX;Z++)for(let v=w.minY;v<=w.maxY;v++){const O=a(this.sourceZ_,Z,v,l);O&&this.sourceTiles_.push(O)}this.sourceTiles_.length===0&&(this.state=c.EMPTY)}}getImage(){return this.canvas_}reproject_(){const e=[];if(this.sourceTiles_.forEach(t=>{t&&t.getState()==c.LOADED&&e.push({extent:this.sourceTileGrid_.getTileCoordExtent(t.tileCoord),image:t.getImage()})}),this.sourceTiles_.length=0,e.length===0)this.state=c.ERROR;else{const t=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(t),n=typeof i=="number"?i:i[0],s=typeof i=="number"?i:i[1],r=this.targetTileGrid_.getResolution(t),l=this.sourceTileGrid_.getResolution(this.sourceZ_),h=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=et(n,s,this.pixelRatio_,l,this.sourceTileGrid_.getExtent(),r,h,this.triangulation_,e,this.gutter_,this.renderEdges_,this.interpolate),this.state=c.LOADED}this.changed()}load(){if(this.state==c.IDLE){this.state=c.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(t=>{const i=t.getState();if(i==c.IDLE||i==c.LOADING){e++;const n=tt(t,Ye.CHANGE,function(s){const r=t.getState();(r==c.LOADED||r==c.ERROR||r==c.EMPTY)&&(Ce(n),e--,e===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(n)}}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(t,i,n){t.getState()==c.IDLE&&t.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(Ce),this.sourcesListenerKeys_=null}release(){this.canvas_&&(it(this.canvas_.getContext("2d")),nt.push(this.canvas_),this.canvas_=null),super.release()}}class Lt{constructor(e){this.highWaterMark=e!==void 0?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(e){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(e){return this.entries_.hasOwnProperty(e)}forEach(e){let t=this.oldest_;for(;t;)e(t.value_,t.key_,this),t=t.newer}get(e,t){const i=this.entries_[e];return I(i!==void 0,"Tried to get a value for a key that does not exist in the cache"),i===this.newest_||(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i),i.value_}remove(e){const t=this.entries_[e];return I(t!==void 0,"Tried to get a value for a key that does not exist in the cache"),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_}getCount(){return this.count_}getKeys(){const e=new Array(this.count_);let t=0,i;for(i=this.newest_;i;i=i.older)e[t++]=i.key_;return e}getValues(){const e=new Array(this.count_);let t=0,i;for(i=this.newest_;i;i=i.older)e[t++]=i.value_;return e}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(e){var t;return(t=this.entries_[e])==null?void 0:t.value_}pop(){const e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_}replace(e,t){this.get(e),this.entries_[e].value_=t}set(e,t){I(!(e in this.entries_),"Tried to set a value for a key that is used already");const i={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[e]=i,++this.count_}setSize(e){this.highWaterMark=e}}function Ae(o,e,t,i){return i!==void 0?(i[0]=o,i[1]=e,i[2]=t,i):[o,e,t]}function ne(o,e,t){return o+"/"+e+"/"+t}function zt(o){return ne(o[0],o[1],o[2])}function Kt(o){const[e,t,i]=o.substring(o.lastIndexOf("/")+1,o.length).split(",").map(Number);return ne(e,t,i)}function vt(o){return o.split("/").map(Number)}function At(o){return(o[1]<<o[0])+o[2]}function Yt(o,e){const t=o[0],i=o[1],n=o[2];if(e.getMinZoom()>t||t>e.getMaxZoom())return!1;const s=e.getFullTileRange(t);return s?s.containsXY(i,n):!0}class It extends Lt{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(e){for(;this.canExpireCache()&&!(this.peekLast().getKey()in e);)this.pop().release()}pruneExceptNewestZ(){if(this.getCount()===0)return;const e=this.peekFirstKey(),i=vt(e)[0];this.forEach(n=>{n.tileCoord[0]!==i&&(this.remove(zt(n.tileCoord)),n.release())})}}const he={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};class de{constructor(e,t,i,n){this.minX=e,this.maxX=t,this.minY=i,this.maxY=n}contains(e){return this.containsXY(e[1],e[2])}containsTileRange(e){return this.minX<=e.minX&&e.maxX<=this.maxX&&this.minY<=e.minY&&e.maxY<=this.maxY}containsXY(e,t){return this.minX<=e&&e<=this.maxX&&this.minY<=t&&t<=this.maxY}equals(e){return this.minX==e.minX&&this.minY==e.minY&&this.maxX==e.maxX&&this.maxY==e.maxY}extend(e){e.minX<this.minX&&(this.minX=e.minX),e.maxX>this.maxX&&(this.maxX=e.maxX),e.minY<this.minY&&(this.minY=e.minY),e.maxY>this.maxY&&(this.maxY=e.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(e){return this.minX<=e.maxX&&this.maxX>=e.minX&&this.minY<=e.maxY&&this.maxY>=e.minY}}function K(o,e,t,i,n){return n!==void 0?(n.minX=o,n.maxX=e,n.minY=t,n.maxY=i,n):new de(o,e,t,i)}const N=[0,0,0],b=5;class Ge{constructor(e){this.minZoom=e.minZoom!==void 0?e.minZoom:0,this.resolutions_=e.resolutions,I(lt(this.resolutions_,(n,s)=>s-n,!0),"`resolutions` must be sorted in descending order");let t;if(!e.origins){for(let n=0,s=this.resolutions_.length-1;n<s;++n)if(!t)t=this.resolutions_[n]/this.resolutions_[n+1];else if(this.resolutions_[n]/this.resolutions_[n+1]!==t){t=void 0;break}}this.zoomFactor_=t,this.maxZoom=this.resolutions_.length-1,this.origin_=e.origin!==void 0?e.origin:null,this.origins_=null,e.origins!==void 0&&(this.origins_=e.origins,I(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const i=e.extent;i!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=Xe(i)),I(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,e.tileSizes!==void 0&&(this.tileSizes_=e.tileSizes,I(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=e.tileSize!==void 0?e.tileSize:this.tileSizes_?null:be,I(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=i!==void 0?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],e.sizes!==void 0?this.fullTileRanges_=e.sizes.map((n,s)=>{const r=new de(Math.min(0,n[0]),Math.max(n[0]-1,-1),Math.min(0,n[1]),Math.max(n[1]-1,-1));if(i){const l=this.getTileRangeForExtentAndZ(i,s);r.minX=Math.max(l.minX,r.minX),r.maxX=Math.min(l.maxX,r.maxX),r.minY=Math.max(l.minY,r.minY),r.maxY=Math.min(l.maxY,r.maxY)}return r}):i&&this.calculateTileRanges_(i)}forEachTileCoord(e,t,i){const n=this.getTileRangeForExtentAndZ(e,t);for(let s=n.minX,r=n.maxX;s<=r;++s)for(let l=n.minY,h=n.maxY;l<=h;++l)i([t,s,l])}forEachTileCoordParentTileRange(e,t,i,n){let s,r,l,h=null,a=e[0]-1;for(this.zoomFactor_===2?(r=e[1],l=e[2]):h=this.getTileCoordExtent(e,n);a>=this.minZoom;){if(r!==void 0&&l!==void 0?(r=Math.floor(r/2),l=Math.floor(l/2),s=K(r,r,l,l,i)):s=this.getTileRangeForExtentAndZ(h,a,i),t(a,s))return!0;--a}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(e){return this.origin_?this.origin_:this.origins_[e]}getResolution(e){return this.resolutions_[e]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(e,t,i){if(e[0]<this.maxZoom){if(this.zoomFactor_===2){const s=e[1]*2,r=e[2]*2;return K(s,s+1,r,r+1,t)}const n=this.getTileCoordExtent(e,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(n,e[0]+1,t)}return null}getTileRangeForTileCoordAndZ(e,t,i){if(t>this.maxZoom||t<this.minZoom)return null;const n=e[0],s=e[1],r=e[2];if(t===n)return K(s,r,s,r,i);if(this.zoomFactor_){const h=Math.pow(this.zoomFactor_,t-n),a=Math.floor(s*h),u=Math.floor(r*h);if(t<n)return K(a,a,u,u,i);const d=Math.floor(h*(s+1))-1,m=Math.floor(h*(r+1))-1;return K(a,d,u,m,i)}const l=this.getTileCoordExtent(e,this.tmpExtent_);return this.getTileRangeForExtentAndZ(l,t,i)}getTileRangeForExtentAndZ(e,t,i){this.getTileCoordForXYAndZ_(e[0],e[3],t,!1,N);const n=N[1],s=N[2];this.getTileCoordForXYAndZ_(e[2],e[1],t,!0,N);const r=N[1],l=N[2];return K(n,r,s,l,i)}getTileCoordCenter(e){const t=this.getOrigin(e[0]),i=this.getResolution(e[0]),n=D(this.getTileSize(e[0]),this.tmpSize_);return[t[0]+(e[1]+.5)*n[0]*i,t[1]-(e[2]+.5)*n[1]*i]}getTileCoordExtent(e,t){const i=this.getOrigin(e[0]),n=this.getResolution(e[0]),s=D(this.getTileSize(e[0]),this.tmpSize_),r=i[0]+e[1]*s[0]*n,l=i[1]-(e[2]+1)*s[1]*n,h=r+s[0]*n,a=l+s[1]*n;return De(r,l,h,a,t)}getTileCoordForCoordAndResolution(e,t,i){return this.getTileCoordForXYAndResolution_(e[0],e[1],t,!1,i)}getTileCoordForXYAndResolution_(e,t,i,n,s){const r=this.getZForResolution(i),l=i/this.getResolution(r),h=this.getOrigin(r),a=D(this.getTileSize(r),this.tmpSize_);let u=l*(e-h[0])/i/a[0],d=l*(h[1]-t)/i/a[1];return n?(u=ee(u,b)-1,d=ee(d,b)-1):(u=te(u,b),d=te(d,b)),Ae(r,u,d,s)}getTileCoordForXYAndZ_(e,t,i,n,s){const r=this.getOrigin(i),l=this.getResolution(i),h=D(this.getTileSize(i),this.tmpSize_);let a=(e-r[0])/l/h[0],u=(r[1]-t)/l/h[1];return n?(a=ee(a,b)-1,u=ee(u,b)-1):(a=te(a,b),u=te(u,b)),Ae(i,a,u,s)}getTileCoordForCoordAndZ(e,t,i){return this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,i)}getTileCoordResolution(e){return this.resolutions_[e[0]]}getTileSize(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]}getFullTileRange(e){return this.fullTileRanges_?this.fullTileRanges_[e]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,e):null}getZForResolution(e,t){const i=at(this.resolutions_,e,t||0);return ce(i,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(e,t){return ht(t,0,t.length,2,this.getTileCoordExtent(e))}calculateTileRanges_(e){const t=this.resolutions_.length,i=new Array(t);for(let n=this.minZoom;n<t;++n)i[n]=this.getTileRangeForExtentAndZ(e,n);this.fullTileRanges_=i}}function Xt(o){let e=o.getDefaultTileGrid();return e||(e=Ot(o),o.setDefaultTileGrid(e)),e}function bt(o,e,t){const i=e[0],n=o.getTileCoordCenter(e),s=Ue(t);if(!Ze(s,n)){const r=ue(s),l=Math.ceil((s[0]-n[0])/r);return n[0]+=r*l,o.getTileCoordForCoordAndZ(n,i)}return e}function Dt(o,e,t,i){i=i!==void 0?i:"top-left";const n=je(o,e,t);return new Ge({extent:o,origin:ut(o,i),resolutions:n,tileSize:t})}function Nt(o){const e=o||{},t=e.extent||Oe("EPSG:3857").getExtent(),i={extent:t,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:je(t,e.maxZoom,e.tileSize,e.maxResolution)};return new Ge(i)}function je(o,e,t,i){e=e!==void 0?e:dt,t=D(t!==void 0?t:be);const n=Pe(o),s=ue(o);i=i>0?i:Math.max(s/t[0],n/t[1]);const r=e+1,l=new Array(r);for(let h=0;h<r;++h)l[h]=i/Math.pow(2,h);return l}function Ot(o,e,t,i){const n=Ue(o);return Dt(n,e,t,i)}function Ue(o){o=Oe(o);let e=o.getExtent();if(!e){const t=180*ct.degrees/o.getMetersPerUnit();e=De(-t,-t,t,t)}return e}class Pt extends gt{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX,interpolate:e.interpolate}),this.on,this.once,this.un,this.opaque_=e.opaque!==void 0?e.opaque:!1,this.tilePixelRatio_=e.tilePixelRatio!==void 0?e.tilePixelRatio:1,this.tileGrid=e.tileGrid!==void 0?e.tileGrid:null;const t=[256,256];this.tileGrid&&D(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),t),this.tileCache=new It(e.cacheSize||0),this.tmpSize=[0,0],this.key_=e.key||"",this.tileOptions={transition:e.transition,interpolate:e.interpolate},this.zDirection=e.zDirection?e.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(e,t){const i=this.getTileCacheForProjection(e);i&&i.expireCache(t)}forEachLoadedTile(e,t,i,n){const s=this.getTileCacheForProjection(e);if(!s)return!1;let r=!0,l,h,a;for(let u=i.minX;u<=i.maxX;++u)for(let d=i.minY;d<=i.maxY;++d)h=ne(t,u,d),a=!1,s.containsKey(h)&&(l=s.get(h),a=l.getState()===c.LOADED,a&&(a=n(l)!==!1)),a||(r=!1);return r}getGutterForProjection(e){return 0}getKey(){return this.key_}setKey(e){this.key_!==e&&(this.key_=e,this.changed())}getOpaque(e){return this.opaque_}getResolutions(e){const t=e?this.getTileGridForProjection(e):this.tileGrid;return t?t.getResolutions():null}getTile(e,t,i,n,s){return Ie()}getTileGrid(){return this.tileGrid}getTileGridForProjection(e){return this.tileGrid?this.tileGrid:Xt(e)}getTileCacheForProjection(e){const t=this.getProjection();return I(t===null||ft(t,e),"A VectorTile source can only be rendered if it has a projection compatible with the view projection."),this.tileCache}getTilePixelRatio(e){return this.tilePixelRatio_}getTilePixelSize(e,t,i){const n=this.getTileGridForProjection(i),s=this.getTilePixelRatio(t),r=D(n.getTileSize(e),this.tmpSize);return s==1?r:_t(r,s,this.tmpSize)}getTileCoordForTileUrlFunction(e,t){t=t!==void 0?t:this.getProjection();const i=this.getTileGridForProjection(t);return this.getWrapX()&&t.isGlobal()&&(e=bt(i,e,t)),Yt(e,i)?e:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(e,t){const i=this.getTileCacheForProjection(t);e>i.highWaterMark&&(i.highWaterMark=e)}useTile(e,t,i,n){}}class Zt extends Tt{constructor(e,t){super(e),this.tile=t}}function Mt(o,e){const t=/\{z\}/g,i=/\{x\}/g,n=/\{y\}/g,s=/\{-y\}/g;return function(r,l,h){if(r)return o.replace(t,r[0].toString()).replace(i,r[1].toString()).replace(n,r[2].toString()).replace(s,function(){const a=r[0],u=e.getFullTileRange(a);if(!u)throw new Error("The {-y} placeholder requires a tile grid with extent");return(u.getHeight()-r[2]-1).toString()})}}function Gt(o,e){const t=o.length,i=new Array(t);for(let n=0;n<t;++n)i[n]=Mt(o[n],e);return jt(i)}function jt(o){return o.length===1?o[0]:function(e,t,i){if(!e)return;const n=At(e),s=mt(n,o.length);return o[s](e,t,i)}}function Ut(o){const e=[];let t=/\{([a-z])-([a-z])\}/.exec(o);if(t){const i=t[1].charCodeAt(0),n=t[2].charCodeAt(0);let s;for(s=i;s<=n;++s)e.push(o.replace(t[0],String.fromCharCode(s)));return e}if(t=/\{(\d+)-(\d+)\}/.exec(o),t){const i=parseInt(t[2],10);for(let n=parseInt(t[1],10);n<=i;n++)e.push(o.replace(t[0],n.toString()));return e}return e.push(o),e}class ke extends Pt{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===ke.prototype.tileUrlFunction,this.tileLoadFunction=e.tileLoadFunction,e.tileUrlFunction&&(this.tileUrlFunction=e.tileUrlFunction),this.urls=null,e.urls?this.setUrls(e.urls):e.url&&this.setUrl(e.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(e){const t=e.target,i=P(t),n=t.getState();let s;n==c.LOADING?(this.tileLoadingKeys_[i]=!0,s=he.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],s=n==c.ERROR?he.TILELOADERROR:n==c.LOADED?he.TILELOADEND:void 0),s!=null&&this.dispatchEvent(new Zt(s,t))}setTileLoadFunction(e){this.tileCache.clear(),this.tileLoadFunction=e,this.changed()}setTileUrlFunction(e,t){this.tileUrlFunction=e,this.tileCache.pruneExceptNewestZ(),typeof t<"u"?this.setKey(t):this.changed()}setUrl(e){const t=Ut(e);this.urls=t,this.setUrls(t)}setUrls(e){this.urls=e;const t=e.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(Gt(e,this.tileGrid),t):this.setKey(t)}tileUrlFunction(e,t,i){}useTile(e,t,i){const n=ne(e,t,i);this.tileCache.containsKey(n)&&this.tileCache.get(n)}}const qt={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class Wt extends xt{constructor(e){super(e),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=pt(),this.tmpTileRange_=new de(0,0,0,0)}isDrawableTile(e){const t=this.getLayer(),i=e.getState(),n=t.getUseInterimTilesOnError();return i==c.LOADED||i==c.EMPTY||i==c.ERROR&&!n}getTile(e,t,i,n){const s=n.pixelRatio,r=n.viewState.projection,l=this.getLayer();let a=l.getSource().getTile(e,t,i,s,r);return a.getState()==c.ERROR&&l.getUseInterimTilesOnError()&&l.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(a)||(a=a.getInterimTile()),a}getData(e){const t=this.frameState;if(!t)return null;const i=this.getLayer(),n=Se(t.pixelToCoordinateTransform,e.slice()),s=i.getExtent();if(s&&!Ze(s,n))return null;const r=t.pixelRatio,l=t.viewState.projection,h=t.viewState,a=i.getRenderSource(),u=a.getTileGridForProjection(h.projection),d=a.getTilePixelRatio(t.pixelRatio);for(let m=u.getZForResolution(h.resolution);m>=u.getMinZoom();--m){const _=u.getTileCoordForCoordAndZ(n,m),g=a.getTile(m,_[1],_[2],r,l);if(!(g instanceof St||g instanceof ve)||g instanceof ve&&g.getState()===c.EMPTY)return null;if(g.getState()!==c.LOADED)continue;const f=u.getOrigin(m),C=D(u.getTileSize(m)),E=u.getResolution(m),R=Math.floor(d*((n[0]-f[0])/E-_[1]*C[0])),y=Math.floor(d*((f[1]-n[1])/E-_[2]*C[1])),x=Math.round(d*a.getGutterForProjection(h.projection));return this.getImageData(g.getImage(),R+x,y+x)}return null}loadedTileCallback(e,t,i){return this.isDrawableTile(i)?super.loadedTileCallback(e,t,i):!1}prepareFrame(e){return!!this.getLayer().getSource()}renderFrame(e,t){const i=e.layerStatesArray[e.layerIndex],n=e.viewState,s=n.projection,r=n.resolution,l=n.center,h=n.rotation,a=e.pixelRatio,u=this.getLayer(),d=u.getSource(),m=d.getRevision(),_=d.getTileGridForProjection(s),g=_.getZForResolution(r,d.zDirection),f=_.getResolution(g);let C=e.extent;const E=e.viewState.resolution,R=d.getTilePixelRatio(a),y=Math.round(ue(C)/E*a),x=Math.round(Pe(C)/E*a),p=i.extent&&Fe(i.extent);p&&(C=ie(C,Fe(i.extent)));const w=f*y/2/R,Z=f*x/2/R,v=[l[0]-w,l[1]-Z,l[0]+w,l[1]+Z],O=_.getTileRangeForExtentAndZ(C,g),q={};q[g]={};const ge=this.createLoadedTileFinder(d,s,q),fe=this.tmpExtent,_e=this.tmpTileRange_;this.newTiles_=!1;const Ke=h?Le(n.center,E,h,e.size):void 0;for(let X=O.minX;X<=O.maxX;++X)for(let S=O.minY;S<=O.maxY;++S){if(h&&!_.tileCoordIntersectsViewport([g,X,S],Ke))continue;const F=this.getTile(g,X,S,e);if(this.isDrawableTile(F)){const j=P(this);if(F.getState()==c.LOADED){q[g][F.tileCoord.toString()]=F;let U=F.inTransition(j);U&&i.opacity!==1&&(F.endTransition(j),U=!1),!this.newTiles_&&(U||!this.renderedTiles.includes(F))&&(this.newTiles_=!0)}if(F.getAlpha(j,e.time)===1)continue}const oe=_.getTileCoordChildTileRange(F.tileCoord,_e,fe);let H=!1;oe&&(H=ge(g+1,oe)),H||_.forEachTileCoordParentTileRange(F.tileCoord,ge,_e,fe)}const Q=f/r*a/R;ze(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/a,1/a,h,-y/2,-x/2);const se=Et(this.pixelTransform);this.useContainer(t,se,this.getBackground(e));const T=this.context,M=T.canvas;Rt(this.inversePixelTransform,this.pixelTransform),ze(this.tempTransform,y/2,x/2,Q,Q,0,-y/2,-x/2),M.width!=y||M.height!=x?(M.width=y,M.height=x):this.containerReused||T.clearRect(0,0,y,x),p&&this.clipUnrotated(T,e,p),d.getInterpolate()||(T.imageSmoothingEnabled=!1),this.preRender(T,e),this.renderedTiles.length=0;let W=Object.keys(q).map(Number);W.sort(yt);let G,re,z;i.opacity===1&&(!this.containerReused||d.getOpaque(e.viewState.projection))?W=W.reverse():(G=[],re=[]);for(let X=W.length-1;X>=0;--X){const S=W[X],F=d.getTilePixelSize(S,a,s),H=_.getResolution(S)/f,j=F[0]*H*Q,U=F[1]*H*Q,le=_.getTileCoordForCoordAndZ(Xe(v),S),Te=_.getTileCoordExtent(le),$=Se(this.tempTransform,[R*(Te[0]-v[0])/f,R*(v[3]-Te[3])/f]),Ne=R*d.getGutterForProjection(s),me=q[S];for(const qe in me){const k=me[qe],xe=k.tileCoord,pe=le[1]-xe[1],We=Math.round($[0]-(pe-1)*j),Ee=le[2]-xe[2],He=Math.round($[1]-(Ee-1)*U),A=Math.round($[0]-pe*j),Y=Math.round($[1]-Ee*U),B=We-A,V=He-Y,Re=g===S,ye=Re&&k.getAlpha(P(this),e.time)!==1;let ae=!1;if(!ye)if(G){z=[A,Y,A+B,Y,A+B,Y+V,A,Y+V];for(let J=0,Be=G.length;J<Be;++J)if(g!==S&&S<re[J]){const L=G[J];wt([A,Y,A+B,Y+V],[L[0],L[3],L[4],L[7]])&&(ae||(T.save(),ae=!0),T.beginPath(),T.moveTo(z[0],z[1]),T.lineTo(z[2],z[3]),T.lineTo(z[4],z[5]),T.lineTo(z[6],z[7]),T.moveTo(L[6],L[7]),T.lineTo(L[4],L[5]),T.lineTo(L[2],L[3]),T.lineTo(L[0],L[1]),T.clip())}G.push(z),re.push(S)}else T.clearRect(A,Y,B,V);this.drawTileImage(k,e,A,Y,B,V,Ne,Re),G&&!ye?(ae&&T.restore(),this.renderedTiles.unshift(k)):this.renderedTiles.push(k),this.updateUsedTiles(e.usedTiles,d,k)}}return this.renderedRevision=m,this.renderedResolution=f,this.extentChanged=!this.renderedExtent_||!Ct(this.renderedExtent_,v),this.renderedExtent_=v,this.renderedPixelRatio=a,this.renderedProjection=s,this.manageTilePyramid(e,d,_,a,s,C,g,u.getPreload()),this.scheduleExpireCache(e,d),this.postRender(T,e),i.extent&&T.restore(),T.imageSmoothingEnabled=!0,se!==M.style.transform&&(M.style.transform=se),this.container}drawTileImage(e,t,i,n,s,r,l,h){const a=this.getTileImage(e);if(!a)return;const u=P(this),d=t.layerStatesArray[t.layerIndex],m=d.opacity*(h?e.getAlpha(u,t.time):1),_=m!==this.context.globalAlpha;_&&(this.context.save(),this.context.globalAlpha=m),this.context.drawImage(a,l,l,a.width-2*l,a.height-2*l,i,n,s,r),_&&this.context.restore(),m!==d.opacity?t.animate=!0:h&&e.endTransition(u)}getImage(){const e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}scheduleExpireCache(e,t){if(t.canExpireCache()){const i=(function(n,s,r){const l=P(n);l in r.usedTiles&&n.expireCache(r.viewState.projection,r.usedTiles[l])}).bind(null,t);e.postRenderFunctions.push(i)}}updateUsedTiles(e,t,i){const n=P(t);n in e||(e[n]={}),e[n][i.getKey()]=!0}manageTilePyramid(e,t,i,n,s,r,l,h,a){const u=P(t);u in e.wantedTiles||(e.wantedTiles[u]={});const d=e.wantedTiles[u],m=e.tileQueue,_=i.getMinZoom(),g=e.viewState.rotation,f=g?Le(e.viewState.center,e.viewState.resolution,g,e.size):void 0;let C=0,E,R,y,x,p,w;for(w=_;w<=l;++w)for(R=i.getTileRangeForExtentAndZ(r,w,R),y=i.getResolution(w),x=R.minX;x<=R.maxX;++x)for(p=R.minY;p<=R.maxY;++p)g&&!i.tileCoordIntersectsViewport([w,x,p],f)||(l-w<=h?(++C,E=t.getTile(w,x,p,n,s),E.getState()==c.IDLE&&(d[E.getKey()]=!0,m.isKeyQueued(E.getKey())||m.enqueue([E,u,i.getTileCoordCenter(E.tileCoord),y])),a!==void 0&&a(E)):t.useTile(w,x,p,s));t.updateCacheSize(C,s)}}export{Wt as C,St as I,ve as R,It as T,ke as U,zt as a,ne as b,Nt as c,qt as d,Ue as e,Me as f,Xt as g,vt as h,Kt as i,Ge as j};
//# sourceMappingURL=TileLayer-D9SmqCHO.js.map
